日志模块架构体系： 用户表—》用户登录会话日志—》用户任务(模块)日志—》用户数据操作日志。

设计日志模块，要考虑多个层面：

1、  用户会话管理：主要记录登录、注销、用户端信息。

2、  用户行为管理：主要记录用户操作行为习惯，记录模块加载/卸载、功能使用率。

3、  数据操作日志管理：主要记录用户数据流的变化情况，可追溯、分析、恢复。

4、  日志分析审计：处理分析日志，总结与报告。

会话/任务日志比较简 单，重点在数据操作日志，因为ERP系统数据表多，结构复杂，数据量也大。数据操作先要理清记录日志的方式。增加记录是否要记日志，笔者的理解不需要。只 有当数据被更改或删除时才需要记录日志。如果增加需要记录，那么它的数据量就非常大了，不推荐。修改数据时或删除时，记录修改或删除前的数据，同时记录用 户会话信息，而不是用户ID，这样防止非法用户篡改日志数据。

数据日志表如何设计，是 用一个表，还是每个表对应一个日志表，笔者推荐后者。如果技术达不到的话，就用一个表，但追溯、恢复、分析数据就难了，因为表结构不同，不能冗余的将日志 数据放在一起，不利于恢复，分析。同时，如果不同的表对应一个日志表处理起来也是非常复杂，增加编程难度，但是技术是可以克服的。

注意：强烈不推荐使用DBMS引擎的触发器，使用它后，数据库服务器的性能会大大地降低(特别是在使用不当的时候，情况更糟)，并且也不可以在每个表上做触发器，有时业务逻辑日志，触发器根本没用，另外触发器记录的信息有限，不足以提供分析、审计所要的信息。



如果是按照每张业务单据表对应一个日志表，那么操作日志表最好不要放在同一个数据库上，可单独建立一个日志库，表结构就是对应的每张业务单据的表结构加上日志记录相关字段，日志表名则以业务单据表名+“_Logs”为统一后缀格式，以方便统计及批量处理日志表。

批量处理日志表，因为这 样相关的业务单据太多，不太可能每个业务单据都去手工建立一一对应的日志表，对于批量处理的事务，交给DBMS。主要是处理思路，数据库一般都支持处理数 据定义DML语句(创建表、视图等)，在程序中动态调用处理定义日志表结构，然后将数据日志内容一起提交给数据库服务器就可以了，或者在数据库定义一个存 储过程处理。

 注意：以上代码只是取表对像信息，如Image、二进制数据等等字段没有加入，因为这些数据没必加入日志。在插入日志数据内容时，同样也可以用上面的方式，提取需要的字段，插入日志表，并记录用户操作信息。